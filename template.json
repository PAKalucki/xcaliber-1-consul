{
    "variables": {
      "consul_version": "1.7.2",
      "consult_template_version": "0.24.1",
      "consul_config_dir": "/etc/consul",
      "consul_data_dir": "/var/consul",
      "consul_service_type": "server",
      "server_join_address": ""
    },
    "builders": [
      {
        "type": "virtualbox-iso",
        "iso_url": "http://ftp.man.poznan.pl/pub/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso",
        "iso_checksum": "9a2c47d97b9975452f7d582264e9fc16d108ed8252ac6816239a3b58cef5c53d",
        "iso_checksum_type": "sha256",
        "vm_name": "CentOS7_consul_{{user `consul_service_type`}}",
        "guest_os_type": "RedHat_64",
        "ssh_username": "root",
        "ssh_password": "packer",
        "ssh_port": 22,
        "ssh_timeout": "20m",
        "headless": true,
        "vboxmanage": [
          ["modifyvm", "{{.Name}}", "--memory", "1024"],
          ["modifyvm", "{{.Name}}", "--cpus", "1"]
        ],
        "http_directory": "http",
        "boot_command": [
          "<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>"
        ],
        "boot_wait": "10s",
        "disk_size": 8192
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "inline": "yum -y install epel-release && yum -y install unzip python-pip && yum -y update && yum clean all"
      },
      {
        "type": "shell",
        "inline": "pip install python-consul"
      },
      {
      "type": "ansible",
      "playbook_file": "./playbook.yml",
      "extra_arguments": [
        "-v", "--extra-vars", "consul_version={{user `consul_version`}} consult_template_version={{user `consult_template_version`}} consul_config_dir={{user `consul_config_dir`}} consul_data_dir={{user `consul_data_dir`}} consul_service_type={{user `consul_service_type`}} server_join_address={{user `server_join_address`}}"
      ]
      }]
  }